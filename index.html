<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>إشارات شراء وبيع (أحدث 10 أيام)</title>
<style>
  body { font-family: Arial, sans-serif; background:#1c1c1c; color:#eaeaea; padding:20px; }
  textarea { width:100%; height:200px; background:#2c2c2c; color:#eaeaea; border:none; padding:10px; margin-bottom:10px; }
  button { padding:10px 15px; margin-bottom:10px; cursor:pointer; background:#444; color:#fff; border:none; border-radius:5px; }
  table { width:100%; border-collapse: collapse; margin-top:10px; }
  th, td { border:1px solid #555; padding:8px; text-align:center; }
  th { background:#333; }
  tr:nth-child(even){ background:#2a2a2a; }
</style>
</head>
<body>
<h2>إشارات التداول (أحدث 10 أيام) مع مستويات الدخول وStop Loss وTake Profit</h2>

<textarea id="dataInput" placeholder="الصق بياناتك هنا CSV: time,open,high,low,close,volume"></textarea>
<button onclick="processData()">تحليل البيانات</button>

<table id="signalsTable">
<thead>
<tr>
<th>تاريخ</th>
<th>نوع الإشارة</th>
<th>سعر الدخول</th>
<th>Stop Loss</th>
<th>Take Profit</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
function toTs(t){ return (typeof t==='number') ? t : Math.floor(new Date(t).getTime()/1000); }

function parseCSV(text){
  const lines = text.trim().split(/\r?\n/).filter(Boolean);
  const out=[];
  for(let i=0;i<lines.length;i++){
    const [time,o,h,l,c,v] = lines[i].split(/,|;/).map(x=>x.replace(/,/g,'').trim());
    out.push({time:toTs(time), open:+o, high:+h, low:+l, close:+c, volume:+v});
  }
  return out;
}

function generateSignals(data){
  const signals=[];
  const lookback = 10; // آخر 10 أيام
  const riskPct = 0.5; // 0.5% للـ Stop Loss
  const rewardPct = 1; // 1% للـ Take Profit

  for(let i=lookback-1;i<data.length;i++){
    const windowData = data.slice(i-lookback+1,i+1); // آخر 10 أيام
    const lows = windowData.map(d=>d.low);
    const highs = windowData.map(d=>d.high);
    const support = Math.min(...lows);
    const resistance = Math.max(...highs);
    const d = data[i];

    if(d.close <= support){ // اشارة شراء
      const entry = d.close;
      const sl = entry*(1-riskPct/100);
      const tp = entry*(1+rewardPct/100);
      signals.push({date:new Date(d.time*1000).toLocaleString('ar-EG'), type:'شراء ↑', entry:entry.toFixed(2), sl:sl.toFixed(2), tp:tp.toFixed(2)});
    }
    else if(d.close >= resistance){ // اشارة بيع
      const entry = d.close;
      const sl = entry*(1+riskPct/100);
      const tp = entry*(1-rewardPct/100);
      signals.push({date:new Date(d.time*1000).toLocaleString('ar-EG'), type:'بيع ↓', entry:entry.toFixed(2), sl:sl.toFixed(2), tp:tp.toFixed(2)});
    }
  }
  return signals;
}

function processData(){
  const text = document.getElementById('dataInput').value;
  const data = parseCSV(text);
  const signals = generateSignals(data);
  const tbody = document.querySelector('#signalsTable tbody');
  tbody.innerHTML = '';
  for(const s of signals){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.date}</td><td>${s.type}</td><td>${s.entry}</td><td>${s.sl}</td><td>${s.tp}</td>`;
    tbody.appendChild(tr);
  }
}
</script>
</body>
</html>
